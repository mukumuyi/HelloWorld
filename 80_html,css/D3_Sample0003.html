<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3.js Timeline Chart</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
        /* タイムラインのスタイルを追加できます */
        .timeline {
            border-top: 1px solid #ccc;
            padding-top: 20px;
            position: relative;
        }

        .lane {
            position: relative;
            margin-bottom: 30px;
        }

        .event {
            position: absolute;
            height: 20px;
            width: 4px;
            background-color: #3498db;
            margin-left: -2px;
        }

        .event-label {
            font-size: 12px;
            text-align: center;
            margin-top: 5px;
        }

        .axis {
            font-size: 10px;
        }
    </style>
</head>
<body>

    <div id="timeline" class="timeline"></div>

    <script>
        // タイムラインのデータ
        var timelineData = [
            { group: "Group 1", start: "2023-01-01", end: "2023-01-05", label: "Event 1" },
            { group: "Group 2", start: "2023-03-15", end: "2023-03-20", label: "Event 2" },
            { group: "Group 3", start: "2023-07-10", end: "2023-07-15", label: "Event 3" },
            { group: "Group 1", start: "2023-02-01", end: "2023-02-05", label: "Event 4" }
            // ここに必要なデータを追加できます
        ];

        // タイムラインの描画
        var margin = { top: 10, right: 30, bottom: 30, left: 80 };
        var width = 600 - margin.left - margin.right;
        var height = 150 - margin.top - margin.bottom;

        // Adjust the horizontal offset here
        var xOffset = 50; // 5 cm converted to pixels

        var svg = d3.select("#timeline")
            .append("svg")
            .attr("width", width + margin.left + margin.right + xOffset)
            .attr("height", height + margin.top + margin.bottom);

        var parseDate = d3.timeParse("%Y-%m-%d");

        timelineData.forEach(function (d) {
            d.start = parseDate(d.start);
            d.end = parseDate(d.end);
        });

        var x = d3.scaleTime()
            .domain([d3.min(timelineData, d => d.start), d3.max(timelineData, d => d.end)])
            .range([0, width]);

        // Adjust the translation for the entire visualization
        svg.attr("transform", "translate(" + xOffset + "," + margin.top + ")");

        var groups = d3.map(timelineData, function(d) { return d.group; }).keys();

        var lanes = svg.selectAll(".lane")
            .data(groups)
            .enter().append("g")
            .attr("class", "lane")
            .attr("transform", function (d, i) { return "translate(0," + i * 40 + ")"; });

        lanes.append("text")
            .attr("x", -margin.left + 5) // Adjusted the x-coordinate
            .attr("y", 15)
            .attr("dy", "0.35em") // Center the text vertically
            .text(function (d) { return d; });

        var events = lanes.selectAll(".event")
            .data(function (group) { 
                return timelineData.filter(function (d) { return d.group === group; });
            })
            .enter().append("g")
            .attr("class", "event")
            .attr("transform", function (d) { return "translate(" + x(d.start) + ",0)"; });

        events.append("rect")
            .attr("height", 20)
            .attr("width", function (d) { return x(d.end) - x(d.start); })
            .attr("fill", "#3498db");

        events.append("text")
            .attr("class", "event-label")
            .attr("y", 35)
            .attr("x", 2)
            .text(function (d) { return d.label; });

        // X軸の表示
        var xAxis = d3.axisBottom(x);
        svg.append("g")
            .attr("class", "axis")
            .attr("transform", "translate(0," + (height + 10) + ")")
            .call(xAxis);
    </script>

</body>
</html>
